<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>[RE]Print Studios - Client Portal Dashboard</title>
  <link rel="stylesheet" href="styles/design-system.css" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="portal.css" />
  <link rel="stylesheet" href="styles/progress-tracker-seamless.css" />
  <link rel="stylesheet" href="styles/progress-tracker-tabs.css" />
  <link rel="stylesheet" href="styles/phase-card.css" />
  <link rel="stylesheet" href="styles/feedback-modal.css" />
  <link rel="stylesheet" href="styles/phase-deliverables.css" />
  <link rel="stylesheet" href="styles/phase-timeline.css" />
  <link rel="stylesheet" href="styles/project-modal-enhanced.css" />
  <link rel="stylesheet" href="styles/phase-transitions.css" />
  <link rel="stylesheet" href="styles/project-detail.css" />
  <link rel="stylesheet" href="styles/progress-tracker-fix.css?v=2" />
  <style>
    /* Emergency fixes for dark backgrounds */
    .progress-tracker-container,
    .progress-tracker,
    .phase-timeline,
    .phase-details,
    .phase-tabs-container,
    .phase-tabs-content,
    .phase-tab-content,
    .phase-tabs-nav {
      background: transparent !important;
      background-color: transparent !important;
    }
    
    /* Fix for floating action button */
    .fab-main {
      width: 60px !important;
      height: 60px !important;
      max-width: 60px !important;
      max-height: 60px !important;
      flex-shrink: 0 !important;
    }
    
    /* Temporarily hide floating actions to debug blue square */
    .floating-actions {
      display: none !important;
    }
    
    /* Fix any overflow issues */
    .projects-content {
      overflow: visible !important;
    }
    
    /* Ensure project cards don't have overflow issues */
    .project-card {
      overflow: hidden !important;
    }
    
    /* Fix progress bar containment */
    .progress-bar {
      overflow: hidden !important;
      max-width: 100% !important;
      position: relative !important;
    }
    
    .progress-fill {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      height: 100% !important;
    }
    
    /* Fix inline progress fill overflow */
    .inline-progress-fill {
      height: 8px !important;
      max-height: 8px !important;
    }
    
    /* Hide any oversized blue elements - temporary debug */
    *[style*="background: #0057FF"]:not(.fab-main):not(.btn):not(.btn-primary):not(.progress-fill):not(.phase-tab) {
      max-height: 200px !important;
      overflow: hidden !important;
    }
    
    /* Ensure phase content area is white */
    #phase-tab-content,
    .phase-card-wrapper,
    .error-state {
      background: #ffffff !important;
      background-color: #ffffff !important;
      color: #333333 !important;
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    /* Fix phase tabs background */
    .phase-tabs-nav {
      background: transparent !important;
      padding: 0 !important;
      margin-bottom: 1rem !important;
    }
    
    /* Individual phase tabs */
    .phase-tab {
      background: #ffffff !important;
      color: #333333 !important;
      border: 1px solid #e9ecef !important;
      padding: 0.75rem 1rem !important;
      margin: 0 0.25rem !important;
      border-radius: 6px !important;
      cursor: pointer !important;
    }
    
    .phase-tab.active {
      background: #0057FF !important;
      color: #ffffff !important;
      border-color: #0057FF !important;
    }
    
    .phase-tab.completed {
      background: #27AE60 !important;
      color: #ffffff !important;
      border-color: #27AE60 !important;
    }
    
    .phase-tab.locked {
      background: #f5f5f5 !important;
      color: #999999 !important;
      border-color: #e9ecef !important;
      cursor: not-allowed !important;
    }
    
    /* Fix the phase tabs container */
    #phase-tabs {
      display: flex !important;
      gap: 0.5rem !important;
      padding: 1rem 0 !important;
      background: transparent !important;
      overflow-x: auto !important;
    }
    
    /* Remove dark backgrounds from all nested elements */
    .progress-tracker * {
      background-color: inherit !important;
    }
    
    /* Progress nodes styling */
    .phase-node,
    .node-icon {
      background: #ffffff !important;
      color: #666666 !important;
    }
    
    .phase-node.current {
      background: #0057FF !important;
      color: #ffffff !important;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://js.stripe.com/v3/"></script>
  <script type="module">
    import { ClientPortal } from './components/portal/Portal.js';
    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Initializing Client Portal...');
      try {
        window.portal = new ClientPortal();
        await window.portal.init();
        console.log('Client Portal initialized successfully');
      } catch (error) {
        console.error('Failed to initialize Client Portal:', error);
      }
    });
  </script>
</head>
<body class="portal-body">

  <!-- LOGIN SCREEN -->
  <div id="login-screen" class="login-container">
    <div class="login-form">
      <div class="login-header">
        <h1>[RE]Print Studios</h1>
        <p>Client Portal</p>
      </div>
      <form id="login-form">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required>
        </div>
        <button type="submit" class="btn-login">
          <span class="btn-text">Sign In</span>
          <span class="btn-loading hidden">Signing In...</span>
        </button>
      </form>
      <div class="login-footer">
        <p>Need help? <a href="mailto:hello@kendrickforrest.com">Contact Support</a></p>
      </div>
    </div>
  </div>
  <!-- PORTAL CONTENT (Hidden initially) -->
  <div id="portal-content" class="portal-content hidden">
  
  <!-- PORTAL HEADER -->
  <header class="portal-header">
    <div class="portal-nav">
      <div class="logo">
        <h1>[RE]Print Studios <span class="portal-tag">Portal</span></h1>
      </div>
      <nav class="main-nav">
        <a href="#dashboard" class="nav-link active">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#projects" class="nav-link">
          <i class="fas fa-project-diagram"></i>
          <span>Projects</span>
        </a>
        <a href="#files" class="nav-link">
          <i class="fas fa-folder"></i>
          <span>Files</span>
        </a>
        <a href="#messages" class="nav-link">
          <i class="fas fa-comments"></i>
          <span>Messages</span>
          <span class="nav-badge">8</span>
        </a>
        <a href="#documents" class="nav-link">
          <i class="fas fa-file-alt"></i>
          <span>Documents</span>
        </a>
        <a href="#invoices" class="nav-link">
          <i class="fas fa-file-invoice"></i>
          <span>Invoices</span>
        </a>
      </nav>
      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar">JD</div>
          <span class="user-name">John Doe</span>
        </div>
        <div class="header-actions">
          <button class="btn-icon notification-btn" data-action="toggle-notifications">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </button>
          <button class="btn-logout" data-action="logout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN PORTAL CONTENT -->
  <main class="portal-main">
    
    <!-- DASHBOARD SECTION -->
    <section id="dashboard" class="portal-section active">
      <div class="dashboard-content">
        <!-- Dashboard content will be loaded dynamically by DashboardModule.js -->
        <div class="loading-message">Loading dashboard...</div>
      </div>
    </section>

    <!-- PROJECTS SECTION -->
    <section id="projects" class="portal-section">
      <div class="section-header">
        <h2>[Your Projects]</h2>
        <p>Track progress, view deliverables, and manage project details.</p>
      </div>
      <div class="projects-list">
        <!-- Projects will be loaded here -->
        <p class="loading-message">Loading projects...</p>
      </div>
    </section>

    <!-- FILES SECTION -->
    <section id="files" class="portal-section">
      <div class="section-header">
        <h2>[File Management]</h2>
        <p>Access your project files, downloads, and shared resources.</p>
      </div>
      <div class="file-manager">
        <!-- File manager will be loaded here -->
        <p class="loading-message">Loading files...</p>
      </div>
    </section>

    <!-- MESSAGES SECTION -->
    <section id="messages" class="portal-section">
      <div class="section-header">
        <h2>[Messages]</h2>
        <p>Direct communication with Kendrick about your projects.</p>
      </div>
      <div class="messaging-interface">
        <!-- Messages will be loaded here -->
        <p class="loading-message">Loading messages...</p>
      </div>
    </section>

    <!-- DOCUMENTS SECTION -->
    <section id="documents" class="portal-section">
      <div class="section-header">
        <h2>[Documents]</h2>
        <p>Generate and download project documents, proposals, and reports.</p>
      </div>
      <div id="documents-section">
        <!-- Document generation UI will be loaded here -->
        <p class="loading-message">Loading documents...</p>
      </div>
    </section>

    <!-- INVOICES SECTION -->
    <section id="invoices" class="portal-section">
      <div class="section-header">
        <h2>[Invoices & Billing]</h2>
        <p>View invoices, payment history, and manage billing information.</p>
      </div>
      <div class="invoices-list">
        <!-- Invoices will be loaded here -->
        <p class="loading-message">Loading invoices...</p>
      </div>
    </section>

  </main>

  <!-- QUICK ACTIONS FLOATING BUTTON -->
  <div class="floating-actions">
    <button class="fab-main" data-action="toggle-quick-actions">
      <span class="fab-icon">+</span>
    </button>
    <div class="fab-menu hidden">
      <button class="fab-item" data-action="start-new-message">
        <span class="fab-icon">[MSG]</span>
        <span class="fab-label">New Message</span>
      </button>
      <button class="fab-item" data-action="upload-file">
        <span class="fab-icon">[FILE]</span>
        <span class="fab-label">Upload File</span>
      </button>
    </div>
  </div>

  <!-- Application Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script type="module" src="/components/ProgressTracker.js?v=1.4"></script>
  <script src="/components/StripePayment.js"></script>
  <script type="module" src="/components/portal/Portal.js?v=2.0"></script>
</body>
</html>

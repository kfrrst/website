-- Default Document Templates Migration
-- Adds initial document templates for common use cases

BEGIN;

-- Screen Printing Proposal Template
INSERT INTO document_modules (
  module_id,
  name,
  description,
  template_type,
  template,
  service_filters,
  phase_filters,
  version
) VALUES (
  'proposal_screenprint',
  'Screen Printing Project Proposal',
  'Professional proposal template for screen printing projects',
  'proposal',
  '{{> header}}

<div class="document-title">
  <h1>Screen Printing Project Proposal</h1>
  <p class="subtitle">Prepared for {{client.name}}</p>
</div>

{{> client-info}}

{{> project-summary}}

<div class="section">
  <h2>Project Overview</h2>
  <p>{{project.description}}</p>
  
  {{#if form_data.project_details}}
  <p>{{form_data.project_details}}</p>
  {{/if}}
</div>

<div class="section">
  <h2>Scope of Work</h2>
  <h3>Screen Printing Services Include:</h3>
  <ul>
    <li>Design consultation and artwork preparation</li>
    <li>Screen creation and setup</li>
    <li>Color matching and testing</li>
    <li>Production run of {{form_data.quantity}} items</li>
    <li>Quality control and packaging</li>
  </ul>
  
  {{#if form_data.special_requirements}}
  <h3>Special Requirements:</h3>
  <p>{{form_data.special_requirements}}</p>
  {{/if}}
</div>

<div class="section">
  <h2>Timeline</h2>
  <table>
    <tr>
      <th>Phase</th>
      <th>Duration</th>
      <th>Deliverables</th>
    </tr>
    {{#each phases}}
    <tr>
      <td>{{this.name}}</td>
      <td>{{this.estimated_duration}} days</td>
      <td>{{this.deliverables}}</td>
    </tr>
    {{/each}}
  </table>
</div>

<div class="section">
  <h2>Investment</h2>
  <table>
    <tr>
      <td>Setup Fee:</td>
      <td>{{formatCurrency form_data.setup_fee}}</td>
    </tr>
    <tr>
      <td>Per Unit Cost:</td>
      <td>{{formatCurrency form_data.unit_cost}}</td>
    </tr>
    <tr>
      <td>Quantity:</td>
      <td>{{form_data.quantity}}</td>
    </tr>
    <tr class="total-row">
      <td><strong>Total Investment:</strong></td>
      <td><strong>{{formatCurrency project.total_budget}}</strong></td>
    </tr>
  </table>
</div>

<div class="section">
  <h2>Next Steps</h2>
  <ol>
    <li>Review and approve this proposal</li>
    <li>Sign the service agreement</li>
    <li>Submit 50% deposit to begin production</li>
    <li>Provide final artwork files</li>
  </ol>
</div>

<div class="section signature-section">
  <h2>Acceptance</h2>
  <p>By signing below, you agree to the terms outlined in this proposal.</p>
  
  <div class="signature-grid">
    <div class="signature-block">
      <div class="signature-line"></div>
      <p>Client Signature & Date</p>
    </div>
    <div class="signature-block">
      <div class="signature-line"></div>
      <p>[RE]Print Studios Representative & Date</p>
    </div>
  </div>
</div>

{{> footer}}',
  ARRAY['SP']::TEXT[],
  ARRAY['ONB', 'IDEA']::TEXT[],
  1
);

-- Web Development Proposal Template
INSERT INTO document_modules (
  module_id,
  name,
  description,
  template_type,
  template,
  service_filters,
  phase_filters,
  version
) VALUES (
  'proposal_web',
  'Website Development Proposal',
  'Comprehensive proposal for web development projects',
  'proposal',
  '{{> header}}

<div class="document-title">
  <h1>Website Development Proposal</h1>
  <p class="subtitle">Custom Web Solution for {{client.company}}</p>
</div>

{{> client-info}}

{{> project-summary}}

<div class="section">
  <h2>Project Goals</h2>
  {{#if form_data.project_goals}}
  <p>{{form_data.project_goals}}</p>
  {{else}}
  <ul>
    <li>Create a modern, responsive website</li>
    <li>Improve user experience and engagement</li>
    <li>Increase online visibility and conversions</li>
    <li>Establish a strong digital presence</li>
  </ul>
  {{/if}}
</div>

<div class="section">
  <h2>Proposed Solution</h2>
  <h3>Website Features:</h3>
  <ul>
    <li>Responsive design for all devices</li>
    <li>Content Management System (CMS)</li>
    <li>Search Engine Optimization (SEO)</li>
    <li>Analytics integration</li>
    <li>Contact forms and lead generation</li>
    {{#if form_data.additional_features}}
    <li>{{form_data.additional_features}}</li>
    {{/if}}
  </ul>
  
  <h3>Technology Stack:</h3>
  <ul>
    <li>Frontend: {{form_data.frontend_tech}}</li>
    <li>Backend: {{form_data.backend_tech}}</li>
    <li>Database: {{form_data.database_tech}}</li>
    <li>Hosting: {{form_data.hosting_solution}}</li>
  </ul>
</div>

<div class="section">
  <h2>Development Process</h2>
  <table>
    <tr>
      <th>Phase</th>
      <th>Activities</th>
      <th>Timeline</th>
    </tr>
    {{#each phases}}
    <tr>
      <td><strong>{{this.name}}</strong></td>
      <td>{{this.description}}</td>
      <td>{{this.estimated_duration}} days</td>
    </tr>
    {{/each}}
  </table>
</div>

<div class="section">
  <h2>Investment Breakdown</h2>
  <table>
    <tr>
      <td>Design & Development:</td>
      <td>{{formatCurrency form_data.development_cost}}</td>
    </tr>
    <tr>
      <td>Content Creation:</td>
      <td>{{formatCurrency form_data.content_cost}}</td>
    </tr>
    <tr>
      <td>Testing & Launch:</td>
      <td>{{formatCurrency form_data.testing_cost}}</td>
    </tr>
    <tr class="total-row">
      <td><strong>Total Investment:</strong></td>
      <td><strong>{{formatCurrency project.total_budget}}</strong></td>
    </tr>
  </table>
  
  <h3>Payment Schedule:</h3>
  <ul>
    <li>50% upon project initiation</li>
    <li>25% upon design approval</li>
    <li>25% upon project completion</li>
  </ul>
</div>

<div class="section">
  <h2>Ongoing Support</h2>
  <p>Optional monthly maintenance packages available starting at {{formatCurrency 299}}/month including:</p>
  <ul>
    <li>Security updates and backups</li>
    <li>Content updates (up to 4 hours/month)</li>
    <li>Performance monitoring</li>
    <li>Priority support</li>
  </ul>
</div>

{{> footer}}',
  ARRAY['WEB', 'SAAS']::TEXT[],
  ARRAY['ONB', 'IDEA']::TEXT[],
  1
);

-- Project Status Report Template
INSERT INTO document_modules (
  module_id,
  name,
  description,
  template_type,
  template,
  service_filters,
  phase_filters,
  version
) VALUES (
  'status_report',
  'Project Status Report',
  'Weekly or milestone status report for ongoing projects',
  'report',
  '{{> header}}

<div class="document-title">
  <h1>Project Status Report</h1>
  <p class="subtitle">{{project.name}}</p>
  <p class="report-date">Report Date: {{formatDate generated_date "long"}}</p>
</div>

{{> project-summary}}

<div class="section">
  <h2>Current Phase: {{current_phase}}</h2>
  
  <div class="progress-bar">
    <div class="progress-fill" style="width: {{phase_progress}}%"></div>
  </div>
  <p class="progress-text">{{phase_progress}}% Complete</p>
</div>

<div class="section">
  <h2>Recent Activities</h2>
  <ul>
    {{#each recent_activities}}
    <li>
      <strong>{{formatDate this.date "short"}}:</strong> {{this.description}}
    </li>
    {{/each}}
  </ul>
</div>

<div class="section">
  <h2>Deliverables Status</h2>
  <table>
    <tr>
      <th>Deliverable</th>
      <th>Status</th>
      <th>Due Date</th>
      <th>Notes</th>
    </tr>
    {{#each deliverables}}
    <tr>
      <td>{{this.name}}</td>
      <td><span class="status-{{this.status}}">{{capitalize this.status}}</span></td>
      <td>{{formatDate this.due_date "short"}}</td>
      <td>{{this.notes}}</td>
    </tr>
    {{/each}}
  </table>
</div>

<div class="section">
  <h2>Upcoming Milestones</h2>
  <ul>
    {{#each upcoming_milestones}}
    <li>
      <strong>{{this.name}}</strong> - {{formatDate this.date "short"}}
    </li>
    {{/each}}
  </ul>
</div>

{{#if action_items}}
<div class="section">
  <h2>Action Items for Client</h2>
  <ul>
    {{#each action_items}}
    <li>{{this}}</li>
    {{/each}}
  </ul>
</div>
{{/if}}

<div class="section">
  <h2>Budget Status</h2>
  <table>
    <tr>
      <td>Total Budget:</td>
      <td>{{formatCurrency project.total_budget}}</td>
    </tr>
    <tr>
      <td>Paid to Date:</td>
      <td>{{formatCurrency project.paid_amount}}</td>
    </tr>
    <tr>
      <td>Remaining Balance:</td>
      <td>{{formatCurrency (subtract project.total_budget project.paid_amount)}}</td>
    </tr>
  </table>
</div>

{{> footer}}',
  NULL,
  NULL,
  1
);

-- Service Agreement Template
INSERT INTO document_modules (
  module_id,
  name,
  description,
  template_type,
  template,
  service_filters,
  phase_filters,
  version
) VALUES (
  'service_agreement',
  'Service Agreement',
  'Standard service agreement for all project types',
  'contract',
  '{{> header}}

<div class="document-title">
  <h1>Service Agreement</h1>
</div>

<div class="section">
  <p>This Service Agreement ("Agreement") is entered into on {{formatDate generated_date "long"}} between:</p>
  
  <table>
    <tr>
      <td><strong>Service Provider:</strong></td>
      <td>[RE]Print Studios<br>
          {{brand.contact.address}}<br>
          {{brand.contact.email}}</td>
    </tr>
    <tr>
      <td><strong>Client:</strong></td>
      <td>{{client.name}}<br>
          {{client.company}}<br>
          {{client.email}}</td>
    </tr>
  </table>
</div>

<div class="section">
  <h2>1. Services</h2>
  <p>The Service Provider agrees to provide the following services:</p>
  <ul>
    {{#each project.services}}
    <li>{{this}} Services as detailed in the project proposal</li>
    {{/each}}
  </ul>
</div>

<div class="section">
  <h2>2. Project Timeline</h2>
  <p>The project will proceed through the following phases:</p>
  <ol>
    {{#each phases}}
    <li><strong>{{this.name}}</strong> - Estimated {{this.estimated_duration}} days</li>
    {{/each}}
  </ol>
</div>

<div class="section">
  <h2>3. Payment Terms</h2>
  <p>Total project cost: <strong>{{formatCurrency project.total_budget}}</strong></p>
  <p>Payment schedule as outlined in the proposal, with invoices due within 30 days of receipt.</p>
</div>

<div class="section">
  <h2>4. Client Responsibilities</h2>
  <ul>
    <li>Provide timely feedback and approvals</li>
    <li>Supply necessary content and materials</li>
    <li>Make payments according to schedule</li>
    <li>Communicate project requirements clearly</li>
  </ul>
</div>

<div class="section">
  <h2>5. Intellectual Property</h2>
  <p>Upon final payment, all deliverables and intellectual property rights transfer to the Client, except for any third-party materials or Service Provider''s proprietary tools and methodologies.</p>
</div>

<div class="section">
  <h2>6. Confidentiality</h2>
  <p>Both parties agree to maintain confidentiality of any proprietary information shared during the project.</p>
</div>

<div class="section">
  <h2>7. Termination</h2>
  <p>Either party may terminate this agreement with 30 days written notice. Client is responsible for payment of all work completed up to termination date.</p>
</div>

<div class="section signature-section">
  <h2>Agreement Acceptance</h2>
  
  <div class="signature-grid">
    <div class="signature-block">
      <div class="signature-line"></div>
      <p>Client Name & Date</p>
    </div>
    <div class="signature-block">
      <div class="signature-line"></div>
      <p>[RE]Print Studios Representative & Date</p>
    </div>
  </div>
</div>

{{> footer}}',
  NULL,
  ARRAY['ONB']::TEXT[],
  1
);

-- Add styles for document templates
UPDATE document_modules 
SET template = REPLACE(template, '{{> header}}', '{{> header}}
<style>
  .document-title {
    text-align: center;
    margin: 40px 0;
  }
  
  .document-title h1 {
    color: {{brand.colors.blue}};
    margin-bottom: 10px;
  }
  
  .subtitle {
    color: {{brand.colors.graphite}};
    font-size: 1.2rem;
  }
  
  .section {
    margin-bottom: 40px;
  }
  
  .service-badge {
    display: inline-block;
    background-color: {{brand.colors.blue}};
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    margin-right: 8px;
  }
  
  .status-active,
  .status-in_progress {
    color: {{brand.colors.blue}};
  }
  
  .status-completed {
    color: {{brand.colors.green}};
  }
  
  .status-on_hold {
    color: {{brand.colors.yellow}};
  }
  
  .total-row {
    border-top: 2px solid {{brand.colors.charcoal}};
    font-size: 1.2rem;
  }
  
  .signature-section {
    margin-top: 60px;
  }
  
  .signature-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-top: 40px;
  }
  
  .signature-block {
    text-align: center;
  }
  
  .signature-line {
    border-bottom: 2px solid {{brand.colors.charcoal}};
    margin-bottom: 10px;
    height: 40px;
  }
  
  .progress-bar {
    background-color: #E0E0E0;
    height: 20px;
    border-radius: 10px;
    overflow: hidden;
    margin: 20px 0;
  }
  
  .progress-fill {
    background-color: {{brand.colors.blue}};
    height: 100%;
    transition: width 0.3s ease;
  }
  
  .progress-text {
    text-align: center;
    font-weight: 600;
    color: {{brand.colors.blue}};
  }
</style>
')
WHERE template_type IN ('proposal', 'contract', 'report');

COMMIT;